{% extends "base.html" %}
{% load i18n %}
{% load opencommunity %}

{% block extra-page-id %}
    id="upcoming-meeting"
{% endblock %}

{% block page_header %}
    {% trans "Upcoming Meeting" %}
    {% if object.upcoming_meeting_title and cperms.communities.viewupcoming_community %}
        {% if cperms.community.editagenda_community or object.upcoming_meeting_is_published %}
            - {{object.upcoming_meeting_title}}
        {% endif %}
    {% endif %}
{% endblock %}

{% block pagemenu %}
{% if cperms.community.editagenda_community %}
    <a class="list-group-item" data-rel="form" href="{% url "issue_create_upcoming" community.id %}">{% trans "Create Issue" %}</a>
{% endif %}

{% if cperms.community.editupcoming_community %}
    <a class="list-group-item" data-rel="form"
        href="{% url "upcoming_edit" community.id %}">
        {% trans "Edit" %}
    </a>
{% endif %}

{% if cperms.community.editparticipants_community and community.upcoming_meeting_started %}
    <a class="list-group-item" data-rel="form"
        href="{% url "upcoming_edit_participants" community.id  %}">
        {% trans "Select Participants" %}
    </a>
{% endif %}

{% if cperms.community.editagenda_community %}
    <a class="list-group-item" data-rel="form" 
    href="{% url "upcoming_publish" community.id  %}">
        {% if object.upcoming_meeting_started %}
          {% trans "Summary Draft" %}
        {% else %}
          {% trans "Publish Agenda" %}
        {% endif %}
    </a>
{% endif %}

{% if cperms.community.editupcoming_community %}
    <a class="list-group-item" data-rel="form" 
    href="{% url "upcoming_start" community.id  %}">
        {% if object.upcoming_meeting_started %}
            {% trans "Undo Start Meeting" %}
        {% else %}
            {% trans "Start Meeting" %}
        {% endif %}
    </a>
{% endif %}

{% endblock %}


{% block content %}

    {% if cperms.communities.viewupcoming_community %}
        {% if cperms.community.editagenda_community or object.upcoming_meeting_is_published %}

            {% if object.upcoming_meeting_started %}
                <h2 class="text-center">
                    --{% trans "Meeting started" %}--
                </h2>
            {% else %}

            {% if object.upcoming_meeting_is_published %}
                <h2 class="text-center">
                    --{% trans "Published" %}--
                </h2>
                <h2 class="text-center">
                    ({% trans "Version" %} {{object.upcoming_meeting_version}} - {{object.upcoming_meeting_published_at}})
                </h2>
            {% else %}
                <h2 class="text-center">
                    --{% trans "Draft" %}--
                </h2>
            {% endif %}
            {% endif %}

            <div class="oc_detail_top">
                <dl class="dl-horizontal">
                    <dt>{% trans "Location" %}:</dt>
                    <dd>{{object.upcoming_meeting_location|default:_("Not set yet")}}</dd>
                    <dt>{% trans "Scheduled at" %}:</dt>
                    <dd>{{object.upcoming_meeting_scheduled_at|default:_("Not set yet")}}</dd>
                    {% if object.upcoming_meeting_comments %}
                        <dt>{{object.upcoming_meeting_comments|safe}}</dt>
                    {% endif %}
                </dl>
            </div>

            <div id="agenda-container" class="agenda-list">

                <h2>
                    {% trans "Agenda items" %}
                    <span class="loader">
                        <img src="{{STATIC_URL}}images/ajax-loader.gif" alt="Loading"/>
                    </span>
                </h2>
                <ul id="agenda" class="nav nav-pills nav-stacked">
                    {% for i in object.upcoming_issues %}
                        {% include "communities/_issue.html" %}
                    {% endfor %}
                </ul>
            </div>

            {% if object.upcoming_meeting_started and cperms.community.editupcoming_community %}

                <h2>{% trans "Summary" %}</h2>
                <div class="ui-grid-solo">
                    <div class="ui-block-a">
                        <div class="ui-bar ui-bar-c">
                            <p>
                                <div class="push">
                                    <a data-rel="form" data-role="button" data-theme="a"
                                    data-inline="true"
                                    href="{% url "upcoming_edit_summary" community.id %}" class="btn">
                                        {% trans "Edit" %}
                                    </a>
                                </div>
                                {% if object.upcoming_meeting_summary %}
                                    {{object.upcoming_meeting_summary|safe}}
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

            {% endif %}

            {% if object.upcoming_meeting_started and cperms.meetings.add_meeting %}
                <div class="narrow">
                    <a data-rel="form" data-role="button" data-theme="a"
                    href="{% url "upcoming_close" community.id %}" class="btn">
                        {% trans "Close Meeting" %}
                    </a>
                </div>
            {% endif %}

            {% if cperms.community.editagenda_community %}

                <div id="available-agenda" class="agenda-list">

                    <h2>{% trans "Available Issues" %}</h2>

                    <ul id="available" class="nav nav-pills nav-stacked">
                        {% for i in object.available_issues %}
                            {% include "communities/_issue.html" %}
                        {% endfor %}
                    </ul>

                </div>

            {% endif %}

        {% else %}

            <div class="notice">
                {% trans "Agenda not yet published" %}.
            </div>

        {% endif %}
    {% endif %}

{% endblock %}

{% block extrahead %}
{% endblock %}

{% block scripts %}
    <script src="{{STATIC_URL}}jquery-ui/js/jquery-ui-1.10.2.custom.js"></script>
    <script src="{{STATIC_URL}}js/jquery.ui.touch-punch.js"></script>
    <script src="{{STATIC_URL}}js/upcoming.js"></script>
    <script src="{{STATIC_URL}}js/issues.js"></script>
{% endblock %}
