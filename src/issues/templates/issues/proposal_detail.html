{% extends "base.html" %}
{% load i18n %}
{% load humanize %}

{% block extra-page-id %}
	id="proposal-detail"
{% endblock %}

{% block page_header %}
	{% trans "Proposal" %}
{% endblock %}

{% block header-start %}
    <a href="#proposalpanel" data-icon="bars" data-iconpos="notext" data-rel="panel"></a>
{% endblock %}

{% block startpanel %}
    <div data-role="panel" id="proposalpanel">
        <ul data-role="listview">
            {% if cperms.issues.editclosed_proposal or not object.issue.is_closed %}
                {% if cperms.issues.editopen_proposal or object.created_by == user %}
                    <li><a data-rel="form" href="{{object.get_edit_url}}">{% trans "Edit" %}</a></li>
                    <li><a data-rel="form" href="{{object.get_delete_url}}">{% trans "Delete" %}</a></li>
                {% endif %}
            {% endif %}
            {% if object.is_task and cperms.issues.edittask_proposal %}
                {% if cperms.issues.editclosed_proposal or not object.issue.is_closed %}
                    <li><a data-rel="form" href="{{object.get_edit_task_url}}">{% trans "Reassign task" %}</a></li>
                {% endif %}
            {% endif %}
        </ul>
    </div>
{% endblock %}

{% block content %}

    <div class="proposal" data-id="{{object.id}}"
         data-accepted="{{object.is_accepted|yesno:'1,0'}}">

        <div class="accepted">
        	{% trans "Proposal accepted" %}!
        </div>

    <a class="prop-issue-title" href="{{object.issue.get_absolute_url}}">
        <div class="prop-issue">{{object.issue}}</div>
    </a>

        <div class="ui-grid-solo prop-subject">
			<div class="prop-type">
				<img src="{{STATIC_URL}}m/images/{% if object.type == 1 %}task-icon{% endif %}{% if object.type == 2 %}rule-icon{% endif %}{% if object.type == 3 %}general-icon{% endif %}.png"/>
			</div>
        	<div class="prop-info">
                <h4 class="abstract abstract-title">{{object.title}}</h4>
                <h4 class="abstract assigned_to">
                {% if object.type == 1 %}
                	{% if object.assigned_to %}	
            			<p style="margin: 0; line-height: 14px;"><b>{% trans "Assigned to" %}:</b> {{ object.assigned_to }}</p>
            			{% if object.assigned_to and object.due_by %}{% endif %}
    				{% endif %}
    				{% if object.due_by %}
            			<p style="margin: 0; line-height: 14px;"><b>{% trans "Due by" %}:</b> {{ object.due_by }}</p>
        			{% endif %}
            	{% endif %}
                <p><b>{% trans "By:" %}</b> {{ object.created_by}}. {{ object.created_at}} {# ({{ object.created_at|naturaltime}}) #}</p>
        		</h4>

                <!--{% if object.is_closed %}
                    <span class="label label-inverse large">
                        {% trans "Closed" %}
                    </span>
                {% endif %}-->
	        </div>
        </div>

		<br />
        <!--div class="accepted">
        	{% trans "Proposal accepted" %}!
        </div-->
        {% if object.abstract %}
            <div data-role="collapsible" data-collapsed="false"
                data-theme="c" data-content-theme="d" data-mini="true">
                <h4>{% trans "Abstract" %}</h4>
                <p>{{object.abstract|safe}}</p>
            </div>
        {% endif %}

        {% if object.content %}
            <div class="proposal-info">
                {# <h4>{% trans "Content" %}</h4> #}
                {{object.content|safe}}
            </div>
        {% endif %}

        {% if not object.issue.is_closed and cperms.issues.acceptopen_proposal and object.issue.in_upcoming_meeting and object.issue.community.upcoming_meeting_started %}
            <div class="narrow">
                <a href="#" data-role="button" class="accept" data-theme="a">{% trans "Accept proposal" %}</a>
                <a href="#" data-role="button" class="unaccept" data-theme="a">{% trans "Cancel approval" %}</a>
            </div>

        {% endif %}

    </div>
{% endblock %}


{% block extrahead %}
    <link rel="stylesheet" href="{{STATIC_URL}}css/proposal.css"/>
{% endblock %}

{% block scripts %}
    <script src="{{STATIC_URL}}js/proposal.js"></script>
{% endblock %}
